[req]
distinguished_name = req_distinguished_name
prompt             = no
x509_extensions    = ca_x509_extensions

[ca_x509_extensions]
basicConstraints = CA:TRUE
keyUsage         = cRLSign, keyCertSign

[req_distinguished_name]
C   = US
ST  = Washington
L   = Seattle
CN  = CA

# etcd
[etcd-server]
distinguished_name = etcd-server_distinguished_name
prompt             = no
req_extensions     = etcd-server_req_extensions

[etcd-server_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = server
nsComment            = "etcd-server Certificate"
subjectAltName       = @etcd-server_alt_names
subjectKeyIdentifier = hash

[etcd-server_alt_names]
IP.0  = 127.0.0.1
IP.1  = 192.168.50.200
IP.2  = 192.168.50.201
IP.3  = 192.168.50.202

[etcd-server_distinguished_name]
CN = etcd-server
C  = US
ST = Washington
L  = Seattle

[etcd-controller-0]
distinguished_name = etcd-controller-0_distinguished_name
prompt             = no
req_extensions     = etcd-controller-0_req_extensions

[etcd-controller-0_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client, server
nsComment            = "etcd-controller-0 Certificate"
subjectAltName       = @etcd-controller-0_alt_names
subjectKeyIdentifier = hash

[etcd-controller-0_alt_names]
IP.0  = 127.0.0.1
IP.1  = 192.168.50.200

[etcd-controller-0_distinguished_name]
CN = etcd-controller-0
C  = US
ST = Washington
L  = Seattle

[etcd-controller-1]
distinguished_name = etcd-controller-1_distinguished_name
prompt             = no
req_extensions     = etcd-controller-1_req_extensions

[etcd-controller-1_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client, server
nsComment            = "etcd-controller-1 Certificate"
subjectAltName       = @etcd-controller-1_alt_names
subjectKeyIdentifier = hash

[etcd-controller-1_alt_names]
IP.0  = 127.0.0.1
IP.1  = 192.168.50.201

[etcd-controller-1_distinguished_name]
CN = etcd-controller-1
C  = US
ST = Washington
L  = Seattle

[etcd-controller-2]
distinguished_name = etcd-controller-2_distinguished_name
prompt             = no
req_extensions     = etcd-controller-2_req_extensions

[etcd-controller-2_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client, server
nsComment            = "etcd-controller-2 Certificate"
subjectAltName       = @etcd-controller-2_alt_names
subjectKeyIdentifier = hash

[etcd-controller-2_alt_names]
IP.0  = 127.0.0.1
IP.1  = 192.168.50.202

[etcd-controller-2_distinguished_name]
CN = etcd-controller-2
C  = US
ST = Washington
L  = Seattle

# service-accounts
[service-accounts]
distinguished_name = service-accounts_distinguished_name
prompt             = no
req_extensions     = default_req_extensions

[service-accounts_distinguished_name]
CN = service-accounts

# kube-apiserver
[kube-apiserver]
distinguished_name = kube-apiserver_distinguished_name
prompt             = no
req_extensions     = kube-apiserver_req_extensions

[kube-apiserver_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client, server
nsComment            = "kube-apiserver Certificate"
subjectAltName       = @kube-apiserver_alt_names
subjectKeyIdentifier = hash

[kube-apiserver_alt_names]
IP.0  = 127.0.0.1
IP.1  = 192.168.50.200
IP.2  = 192.168.50.201
IP.3  = 192.168.50.202
DNS.0 = kubernetes
DNS.1 = kubernetes.default
DNS.2 = kubernetes.default.svc
DNS.3 = kubernetes.default.svc.cluster
DNS.4 = kubernetes.svc.cluster.local
DNS.5 = server.kubernetes.local
DNS.6 = api-server.kubernetes.local

[kube-apiserver_distinguished_name]
CN = kube-apiserver
C  = US
ST = Washington
L  = Seattle

# default
[default_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "Admin Client Certificate"
subjectKeyIdentifier = hash

# admin
[admin]
distinguished_name = admin_distinguished_name
prompt             = no
req_extensions     = default_req_extensions

[admin_distinguished_name]
CN = admin
O  = system:masters

# kube-controller-manager
[kube-controller-manager]
distinguished_name = kube-controller-manager_distinguished_name
prompt             = no
req_extensions     = kube-controller-manager_req_extensions

[kube-controller-manager_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "Kube Controller Manager Certificate"
subjectAltName       = DNS:kube-controller-manager, IP:127.0.0.1
subjectKeyIdentifier = hash

[kube-controller-manager_distinguished_name]
CN = system:kube-controller-manager
O  = system:kube-controller-manager
C  = US
ST = Washington
L  = Seattle

# kube-scheduler
[kube-scheduler]
distinguished_name = kube-scheduler_distinguished_name
prompt             = no
req_extensions     = kube-scheduler_req_extensions

[kube-scheduler_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "Kube Scheduler Certificate"
subjectAltName       = DNS:kube-scheduler, IP:127.0.0.1
subjectKeyIdentifier = hash

[kube-scheduler_distinguished_name]
CN = system:kube-scheduler
O  = system:system:kube-scheduler
C  = US
ST = Washington
L  = Seattle

# worker nodes
[worker-0]
distinguished_name = worker-0_distinguished_name
prompt             = no
req_extensions     = worker-0_req_extensions

[worker-0_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "worker-0 Certificate"
subjectAltName       = DNS:worker-0, IP:127.0.0.1
subjectKeyIdentifier = hash

[worker-0_distinguished_name]
CN = system:node:worker-0
O  = system:nodes
C  = US
ST = Washington
L  = Seattle

[worker-1]
distinguished_name = worker-1_distinguished_name
prompt             = no
req_extensions     = worker-1_req_extensions

[worker-1_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "worker-1 Certificate"
subjectAltName       = DNS:worker-1, IP:127.0.0.1
subjectKeyIdentifier = hash

[worker-1_distinguished_name]
CN = system:node:worker-1
O  = system:nodes
C  = US
ST = Washington
L  = Seattle

[worker-2]
distinguished_name = worker-2_distinguished_name
prompt             = no
req_extensions     = worker-2_req_extensions

[worker-2_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "worker-2 Certificate"
subjectAltName       = DNS:worker-2, IP:127.0.0.1
subjectKeyIdentifier = hash

[worker-2_distinguished_name]
CN = system:node:worker-2
O  = system:nodes
C  = US
ST = Washington
L  = Seattle

# kube-proxy
[kube-proxy]
distinguished_name = kube-proxy_distinguished_name
prompt             = no
req_extensions     = kube-proxy_req_extensions

[kube-proxy_req_extensions]
basicConstraints     = CA:FALSE
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
nsCertType           = client
nsComment            = "Kube Proxy Certificate"
subjectAltName       = DNS:kube-proxy, IP:127.0.0.1
subjectKeyIdentifier = hash

[kube-proxy_distinguished_name]
CN = system:kube-proxy
O  = system:node-proxier
C  = US
ST = Washington
L  = Seattle
